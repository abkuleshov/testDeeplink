<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Check</title>
    <script>
        function checkApps() {
            console.log("Начинаем проверку приложений...");
            let appFound = false; // Флаг для отслеживания найденного приложения

            checkApp("triptally:///qr_auth?qr_token=e234234", function() {
                console.log("Triptally не найдено, проверяем KittyCash...");
                checkApp("kittycash:///qr_auth?qr_token=e234234", function() {
                    console.log("Ни одно приложение не найдено, переходим на page1.html.");
                    if (!appFound) {
                        window.location = "page1.html"; // Переход, если ни одно приложение не найдено
                    }
                });
            });

            // Вложенная функция для проверки приложения
            function checkApp(deepLink, callback) {
                console.log(`Проверяем диплинк: ${deepLink}`);
                let iframe = document.createElement("iframe");
                iframe.style.display = "none"; // Скрываем iframe
                iframe.src = deepLink;
                document.body.appendChild(iframe);

                setTimeout(function() {
                    // Проверяем, сработал ли диплинк
                    if (!appFound) {
                        console.log(`Диплинк ${deepLink} не сработал.`);
                        callback(); // Вызов колбэка для следующего приложения
                    } else {
                        console.log(`Диплинк ${deepLink} сработал, приложение открыто.`);
                    }
                }, 2000); // Увеличенное время ожидания 2 секунды

                window.addEventListener("blur", function() {
                    appFound = true; // Если пользователь переключился на другое окно, считаем приложение найденным
                    console.log(`Пользователь переключился на другое окно. Диплинк ${deepLink} сработал.`);
                });
            }
        }

        // Обработчик события загрузки
        document.addEventListener("DOMContentLoaded", function() {
            console.log("Документ загружен. Добавляем обработчик события.");
            document.getElementById("checkBothApps").addEventListener("click", checkApps);
        });
    </script>
</head>
<body>
    <h1>Ищем приложения</h1>
    <button id="checkBothApps">Найти приложение v2</button>
</body>
</html>
